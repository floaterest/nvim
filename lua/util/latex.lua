local List = require("plenary.collections.py_list")
local func = require("plenary.functional")

local nhg = {
	"#not-has-grandparent?",
	"@conceal",
	"title_declaration",
	"author_declaration",
	"chapter",
	"part",
	"section",
	"subsection",
	"subsubsection",
	"paragraph",
	"subparagraph",
	"generic_command",
}

-- conceal to s
local function conceal(s)
	return { '#set! conceal "' .. (s or "") .. '"' }
end

local misc = {
	{ '"\\\\item"', "@punctuation.special", "@conceal", conceal("â€¢") },
}

local function mapsort(tbl, surround)
	local t = func.kv_map(function(kv)
		local k, v = unpack(kv)
		if #surround == 2 then
			return surround[1] .. k .. surround[2]
		else -- #surround == 3
			return surround[1] .. k .. surround[2] .. v .. surround[3]
		end
	end, tbl)
	table.sort(t)
	return unpack(t)
end

-- generic_command on highlight group and conceals
local function generic(h, conceals)
	return {
		"generic_command",
		"command: (command_name) " .. h,
		{ "#has-ancestor? " .. h .. " math_environment inline_formula displayed_equation" },
		{ "#not-has-ancestor? " .. h .. " label_definition text_mode" },
		{ "#any-of? " .. h, mapsort(conceals, { '"\\\\', '"' }) },
		{ "#set-pairs! " .. h .. " conceal", mapsort(conceals, { '"\\\\', '" "', '"' }) },
	}
end

local function text2(h, script, conceals)
	local word = {
		"text",
		"word: (word) " .. h,
		{ "#has-ancestor? " .. h .. " " .. script },
		{ "#has-ancestor? " .. h .. " math_environment inline_formula displayed_equation" },
		{ "#not-has-ancestor? " .. h .. " label_definition text_mode" },
		{ "#any-of? " .. h, mapsort(conceals, { '"', '"' }) },
		{ "#set-pairs! " .. h .. " conceal", mapsort(conceals, { '"', '" "', '"' }) },
	}
	local scri = {
		"text",
		"word: (" .. script .. ") " .. h,
		{ "#has-ancestor? " .. h .. " math_environment inline_formula displayed_equation" },
		{ "#not-has-ancestor? " .. h .. " label_definition text_mode" },
		{ "#any-of? " .. h, mapsort(conceals, { '"_', '"' }) },
		{ "#set-pairs! " .. h .. " conceal", mapsort(conceals, { '"_', '" "', '"' }) },
	}
	return { word, scri }
end

local function generic_t(t)
	local commands = vim.tbl_map(function(c)
		return '"\\\\' .. c .. '"'
	end, t)
	return {
		"generic_command",
		"command: (command_name) @conceal",
		{ "#any-of? @conceal", unpack(commands) },
		conceal(),
	}
end

local function generic_s(conceals)
	local h = "@text.math"
	return {
		{ "generic_command", "command: (command_name)", "arg: (curly_group)" },
		h,
		{ "#any-of? " .. h, mapsort(conceals, { '"\\\\', '"' }) },
		{ "#set-pairs! " .. h .. " conceal", mapsort(conceals, { '"\\\\', '" "', '"' }) },
	}
end

local delimiters = {
	{ 'curly_group "{" @conceal', nhg, conceal() },
	{ 'curly_group "}" @conceal', nhg, conceal() },
	{ "math_delimiter left_command: _ @conceal ", conceal() },
	{ "math_delimiter right_command: _ @conceal ", conceal() },
	{ 'inline_formula "$" @conceal ', conceal() },
	{ 'inline_formula "\\\\(" @conceal ', conceal() },
	{ 'inline_formula "\\\\)" @conceal ', conceal() },
	{ 'displayed_equation "\\\\[" @conceal ', conceal() },
	{ 'displayed_equation "\\\\]" @conceal ', conceal() },
	{ 'displayed_equation "$$" @conceal ', conceal() },
	{ "text_mode command: _ @conceal ", conceal() },
}

local item = { '"\\\\item"', "@punctuation.special", "@conceal", conceal() }

local greek = generic("@text.math", {
	alpha = "Î±",
	beta = "Î²",
	chi = "Ï‡",
	Chi = "Î§",
	delta = "Î´",
	Delta = "Î”",
	eta = "Î·",
	gamma = "Î³",
	Gamma = "Î“",
	iota = "Î¹",
	kappa = "Îº",
	lambda = "Î»",
	Lambda = "Î›",
	mu = "Î¼",
	nu = "Î½",
	omega = "Ï‰",
	Omega = "Î©",
	phi = "Ï•",
	Phi = "Î¦",
	pi = "Ï€",
	Pi = "Î ",
	psi = "Ïˆ",
	Psi = "Î¨",
	rho = "Ï",
	sigma = "Ïƒ",
	Sigma = "Î£",
	tau = "Ï„",
	theta = "Î¸",
	Theta = "Î˜",
	upsilon = "Ï…",
	Upsilon = "Î¥",
	varepsilon = "Îµ",
	varphi = "Ï†",
	varpi = "Ï–",
	varrho = "Ï±",
	varsigma = "Ï‚",
	vartheta = "Ï‘",
	xi = "Î¾",
	Xi = "Î",
	zeta = "Î¶",
})

local operators = generic("@operator", {
	["in"] = "âˆˆ",
	amalg = "âˆ",
	angle = "âˆ ",
	approx = "â‰ˆ",
	operatorname = "",
	ast = "âˆ—",
	asymp = "â‰",
	backslash = "âˆ–",
	because = "âˆµ",
	bigcap = "âˆ©",
	bigcirc = "â—‹",
	bigcup = "âˆª",
	bigodot = "âŠ™",
	bigoplus = "âŠ•",
	bigotimes = "âŠ—",
	bigsqcup = "âŠ”",
	bigtriangledown = "âˆ‡",
	bigtriangleup = "âˆ†",
	bigvee = "â‹",
	rightrightarrows = "â‡‰",
	bigwedge = "â‹€",
	impliedby = "â‡",
	bot = "âŠ¥",
	bowtie = "â‹ˆ",
	bullet = "â€¢",
	cap = "âˆ©",
	cdot = "Â·",
	cdots = "â‹¯",
	circ = "âˆ˜",
	cong = "â‰…",
	coprod = "âˆ",
	copyright = "Â©",
	cup = "âˆª",
	dagger = "â€ ",
	dashv = "âŠ£",
	ddagger = "â€¡",
	ddots = "â‹±",
	diamond = "â‹„",
	div = "Ã·",
	doteq = "â‰",
	dots = "â€¦",
	downarrow = "â†“",
	Downarrow = "â‡“",
	enspace = " ",
	equiv = "â‰¡",
	exists = "âˆƒ",
	flat = "â™­",
	forall = "âˆ€",
	frown = "â”",
	ge = "â‰¥",
	geq = "â‰¥",
	gets = "â†",
	gg = "âŸ«",
	gt = ">",
	hookleftarrow = "â†©",
	hookrightarrow = "â†ª",
	iff = "â‡”",
	Im = "â„‘",
	implies = "â‡’",
	int = "âˆ«",
	jmath = "ğš¥",
	land = "âˆ§",
	langle = "âŸ¨",
	lceil = "âŒˆ",
	ldots = "â€¦",
	le = "â‰¤",
	left = "",
	leftarrow = "â†",
	Leftarrow = "â‡",
	leftharpoondown = "â†½",
	leftharpoonup = "â†¼",
	leftrightarrow = "â†”",
	Leftrightarrow = "â‡”",
	leq = "â‰¤",
	leq = "â‰¤",
	lfloor = "âŒŠ",
	ll = "â‰ª",
	lmoustache = "â•­",
	lor = "âˆ¨",
	lt = "<",
	mapsto = "â†¦",
	mid = "âˆ£",
	models = "â•",
	mp = "âˆ“",
	nabla = "âˆ‡",
	natural = "â™®",
	ne = "â‰ ",
	nearrow = "â†—",
	neg = "Â¬",
	neq = "â‰ ",
	ni = "âˆ‹",
	notin = "âˆ‰",
	nwarrow = "â†–",
	odot = "âŠ™",
	oint = "âˆ®",
	ominus = "âŠ–",
	oplus = "âŠ•",
	oslash = "âŠ˜",
	otimes = "âŠ—",
	owns = "âˆ‹",
	hookrightarrow = "â†ª",
	twoheadrightarrow = "â† ",
	P = "Â¶",
	parallel = "â•‘",
	partial = "âˆ‚",
	perp = "âŠ¥",
	pm = "Â±",
	prec = "â‰º",
	preceq = "âª¯",
	prime = "â€²",
	prod = "âˆ",
	propto = "âˆ",
	qquad = " ",
	quad = " ",
	rangle = "âŸ©",
	rceil = "âŒ‰",
	Re = "â„œ",
	rfloor = "âŒ‹",
	right = "",
	rightarrow = "â†’",
	Rightarrow = "â‡’",
	rightleftharpoons = "â‡Œ",
	rmoustache = "â•®",
	S = "Â§",
	searrow = "â†˜",
	setminus = "âˆ–",
	sharp = "â™¯",
	sim = "âˆ¼",
	simeq = "â‹",
	smile = "â€¿",
	sqcap = "âŠ“",
	sqcup = "âŠ”",
	sqrt = "âˆš",
	sqsubset = "âŠ",
	sqsubseteq = "âŠ‘",
	sqsupset = "âŠ",
	sqsupseteq = "âŠ’",
	star = "âœ«",
	subset = "âŠ‚",
	subseteq = "âŠ†",
	succ = "â‰»",
	succeq = "âª°",
	sum = "âˆ‘",
	supset = "âŠƒ",
	supseteq = "âŠ‡",
	surd = "âˆš",
	swarrow = "â†™",
	therefore = "âˆ´",
	times = "Ã—",
	to = "â†’",
	top = "âŠ¤",
	triangle = "âˆ†",
	triangleleft = "âŠ²",
	triangleright = "âŠ³",
	uparrow = "â†‘",
	Uparrow = "â‡‘",
	updownarrow = "â†•",
	Updownarrow = "â‡•",
	nexists = "âˆ„",
	upharpoonright = "â†¾",
	vdash = "âŠ¢",
	vdots = "â‹®",
	vee = "âˆ¨",
	wedge = "âˆ§",
	vert = "|",
	wp = "â„˜",
	wr = "â‰€",
})

local symbols = generic("@text.math", {
	aleph = "â„µ",
	clubsuit = "â™£",
	diamondsuit = "â™¢",
	ell = "â„“",
	["#"] = "#",
	emptyset = "âˆ…",
	hbar = "â„",
	heartsuit = "â™¡",
	imath = "É©",
	infty = "âˆ",
	spadesuit = "â™ ",
	square = "â–¡",
	varnothing = "âˆ…",
})

local typography = generic_t({
	"emph",
	"mathit",
	"textit",
	"mathbf",
	"textbf",
})

local scripts = generic_s({
	["mathbb{A}"] = "ğ”¸",
	["mathbb{B}"] = "ğ”¹",
	["mathbb{C}"] = "â„‚",
	["mathbb{D}"] = "ğ”»",
	["mathbb{E}"] = "ğ”¼",
	["mathbb{F}"] = "ğ”½",
	["mathbb{G}"] = "ğ”¾",
	["mathbb{H}"] = "â„",
	["mathbb{I}"] = "ğ•€",
	["mathbb{J}"] = "ğ•",
	["mathbb{K}"] = "ğ•‚",
	["mathbb{L}"] = "ğ•ƒ",
	["mathbb{M}"] = "ğ•„",
	["mathbb{N}"] = "â„•",
	["mathbb{O}"] = "ğ•†",
	["mathbb{P}"] = "â„™",
	["mathbb{Q}"] = "â„š",
	["mathbb{R}"] = "â„",
	["mathbb{S}"] = "ğ•Š",
	["mathbb{T}"] = "ğ•‹",
	["mathbb{U}"] = "ğ•Œ",
	["mathbb{V}"] = "ğ•",
	["mathbb{W}"] = "ğ•",
	["mathbb{X}"] = "ğ•",
	["mathbb{Y}"] = "ğ•",
	["mathbb{Z}"] = "â„¤",
	["mathcal{A}"] = "ğ“",
	["mathcal{B}"] = "ğ“‘",
	["mathcal{C}"] = "ğ“’",
	["mathcal{D}"] = "ğ““",
	["mathcal{E}"] = "ğ“”",
	["mathcal{F}"] = "ğ“•",
	["mathcal{G}"] = "ğ“–",
	["mathcal{H}"] = "ğ“—",
	["mathcal{I}"] = "ğ“˜",
	["mathcal{J}"] = "ğ“™",
	["mathcal{K}"] = "ğ“š",
	["mathcal{L}"] = "ğ“›",
	["mathcal{M}"] = "ğ“œ",
	["mathcal{N}"] = "ğ“",
	["mathcal{O}"] = "ğ“",
	["mathcal{P}"] = "ğ“Ÿ",
	["mathcal{Q}"] = "ğ“ ",
	["mathcal{R}"] = "ğ“¡",
	["mathcal{S}"] = "ğ“¢",
	["mathcal{T}"] = "ğ“£",
	["mathcal{U}"] = "ğ“¤",
	["mathcal{V}"] = "ğ“¥",
	["mathcal{W}"] = "ğ“¦",
	["mathcal{X}"] = "ğ“§",
	["mathcal{Y}"] = "ğ“¨",
	["mathcal{Z}"] = "ğ“©",
	["mathfrak{A}"] = "ğ”„",
	["mathfrak{a}"] = "ğ”",
	["mathfrak{B}"] = "ğ”…",
	["mathfrak{b}"] = "ğ”Ÿ",
	["mathfrak{C}"] = "â„­",
	["mathfrak{c}"] = "ğ” ",
	["mathfrak{D}"] = "ğ”‡",
	["mathfrak{d}"] = "ğ”¡",
	["mathfrak{E}"] = "ğ”ˆ",
	["mathfrak{e}"] = "ğ”¢",
	["mathfrak{F}"] = "ğ”‰",
	["mathfrak{f}"] = "ğ”£",
	["mathfrak{G}"] = "ğ”Š",
	["mathfrak{g}"] = "ğ”¤",
	["mathfrak{H}"] = "â„Œ",
	["mathfrak{h}"] = "ğ”¥",
	["mathfrak{I}"] = "â„‘",
	["mathfrak{i}"] = "ğ”¦",
	["mathfrak{J}"] = "ğ”",
	["mathfrak{j}"] = "ğ”§",
	["mathfrak{K}"] = "ğ”",
	["mathfrak{k}"] = "ğ”¨",
	["mathfrak{L}"] = "ğ”",
	["mathfrak{l}"] = "ğ”©",
	["mathfrak{M}"] = "ğ”",
	["mathfrak{m}"] = "ğ”ª",
	["mathfrak{N}"] = "ğ”‘",
	["mathfrak{n}"] = "ğ”«",
	["mathfrak{O}"] = "ğ”’",
	["mathfrak{o}"] = "ğ”¬",
	["mathfrak{P}"] = "ğ”“",
	["mathfrak{p}"] = "ğ”­",
	["mathfrak{Q}"] = "ğ””",
	["mathfrak{q}"] = "ğ”®",
	["mathfrak{R}"] = "â„œ",
	["mathfrak{r}"] = "ğ”¯",
	["mathfrak{S}"] = "ğ”–",
	["mathfrak{s}"] = "ğ”°",
	["mathfrak{T}"] = "ğ”—",
	["mathfrak{t}"] = "ğ”±",
	["mathfrak{U}"] = "ğ”˜",
	["mathfrak{u}"] = "ğ”²",
	["mathfrak{V}"] = "ğ”™",
	["mathfrak{v}"] = "ğ”³",
	["mathfrak{W}"] = "ğ”š",
	["mathfrak{w}"] = "ğ”´",
	["mathfrak{X}"] = "ğ”›",
	["mathfrak{x}"] = "ğ”µ",
	["mathfrak{Y}"] = "ğ”œ",
	["mathfrak{y}"] = "ğ”¶",
	["mathfrak{Z}"] = "â„¨",
	["mathfrak{z}"] = "ğ”·",
	["mathscr{A}"] = "ğ“",
	["mathscr{B}"] = "ğ“‘",
	["mathscr{C}"] = "ğ“’",
	["mathscr{D}"] = "ğ““",
	["mathscr{E}"] = "ğ“”",
	["mathscr{F}"] = "ğ“•",
	["mathscr{G}"] = "ğ“–",
	["mathscr{H}"] = "ğ“—",
	["mathscr{I}"] = "ğ“˜",
	["mathscr{J}"] = "ğ“™",
	["mathscr{K}"] = "ğ“š",
	["mathscr{L}"] = "ğ“›",
	["mathscr{M}"] = "ğ“œ",
	["mathscr{N}"] = "ğ“",
	["mathscr{O}"] = "ğ“",
	["mathscr{P}"] = "ğ“Ÿ",
	["mathscr{Q}"] = "ğ“ ",
	["mathscr{R}"] = "ğ“¡",
	["mathscr{S}"] = "ğ“¢",
	["mathscr{T}"] = "ğ“£",
	["mathscr{U}"] = "ğ“¤",
	["mathscr{V}"] = "ğ“¥",
	["mathscr{W}"] = "ğ“¦",
	["mathscr{X}"] = "ğ“§",
	["mathscr{Y}"] = "ğ“¨",
	["mathscr{Z}"] = "ğ“©",
	["mathsf{A}"] = "ğ– ",
	["mathsf{a}"] = "ğ–º",
	["mathsf{B}"] = "ğ–¡",
	["mathsf{b}"] = "ğ–»",
	["mathsf{C}"] = "ğ–¢",
	["mathsf{c}"] = "ğ–¼",
	["mathsf{D}"] = "ğ–£",
	["mathsf{d}"] = "ğ–½",
	["mathsf{E}"] = "ğ–¤",
	["mathsf{e}"] = "ğ–¾",
	["mathsf{F}"] = "ğ–¥",
	["mathsf{f}"] = "ğ–¿",
	["mathsf{G}"] = "ğ–¦",
	["mathsf{g}"] = "ğ—€",
	["mathsf{H}"] = "ğ–§",
	["mathsf{h}"] = "ğ—",
	["mathsf{I}"] = "ğ–¨",
	["mathsf{i}"] = "ğ—‚",
	["mathsf{J}"] = "ğ–©",
	["mathsf{j}"] = "ğ—ƒ",
	["mathsf{K}"] = "ğ–ª",
	["mathsf{k}"] = "ğ—„",
	["mathsf{L}"] = "ğ–«",
	["mathsf{l}"] = "ğ—…",
	["mathsf{M}"] = "ğ–¬",
	["mathsf{m}"] = "ğ—†",
	["mathsf{N}"] = "ğ–­",
	["mathsf{n}"] = "ğ—‡",
	["mathsf{O}"] = "ğ–®",
	["mathsf{o}"] = "ğ—ˆ",
	["mathsf{P}"] = "ğ–¯",
	["mathsf{p}"] = "ğ—‰",
	["mathsf{Q}"] = "ğ–°",
	["mathsf{q}"] = "ğ—Š",
	["mathsf{R}"] = "ğ–±",
	["mathsf{r}"] = "ğ—‹",
	["mathsf{S}"] = "ğ–²",
	["mathsf{s}"] = "ğ—Œ",
	["mathsf{T}"] = "ğ–³",
	["mathsf{t}"] = "ğ—",
	["mathsf{U}"] = "ğ–´",
	["mathsf{u}"] = "ğ—",
	["mathsf{V}"] = "ğ–µ",
	["mathsf{v}"] = "ğ—",
	["mathsf{W}"] = "ğ–¶",
	["mathsf{w}"] = "ğ—",
	["mathsf{X}"] = "ğ–·",
	["mathsf{x}"] = "ğ—‘",
	["mathsf{Y}"] = "ğ–¸",
	["mathsf{y}"] = "ğ—’",
	["mathsf{Z}"] = "ğ–¹",
	["mathsf{z}"] = "ğ—“",
})

local subscripts = List:concat(
	text2("@text.math", "subscript", {
		["0"] = "â‚€",
		["1"] = "â‚",
		["2"] = "â‚‚",
		["3"] = "â‚ƒ",
		["4"] = "â‚„",
		["5"] = "â‚…",
		["6"] = "â‚†",
		["7"] = "â‚‡",
		["8"] = "â‚ˆ",
		["9"] = "â‚‰",
		a = "â‚",
		e = "â‚‘",
		h = "â‚•",
		i = "áµ¢",
		j = "â±¼",
		k = "â‚–",
		l = "â‚—",
		m = "â‚˜",
		n = "â‚™",
		o = "â‚’",
		p = "â‚š",
		r = "áµ£",
		s = "â‚›",
		t = "â‚œ",
		u = "áµ¤",
		v = "áµ¥",
		x = "â‚“",
	}),
	text2("@operator", "subscript", {
		["+"] = "â‚Š",
		["-"] = "â‚‹",
		["/"] = "Ë",
	})
)

local supscripts = List:concat(

	text2("@text.math", "superscript", {
		["0"] = "â°",
		["1"] = "Â¹",
		["2"] = "Â²",
		["3"] = "Â³",
		["4"] = "â´",
		["5"] = "âµ",
		["6"] = "â¶",
		["7"] = "â·",
		["8"] = "â¸",
		["9"] = "â¹",
		a = "áµƒ",
		b = "áµ‡",
		c = "á¶œ",
		d = "áµˆ",
		e = "áµ‰",
		f = "á¶ ",
		g = "áµ",
		h = "Ê°",
		i = "â±",
		j = "Ê²",
		k = "áµ",
		l = "Ë¡",
		m = "áµ",
		n = "â¿",
		o = "áµ’",
		p = "áµ–",
		r = "Ê³",
		s = "Ë¢",
		t = "áµ—",
		u = "áµ˜",
		v = "áµ›",
		w = "Ê·",
		x = "Ë£",
		y = "Ê¸",
		z = "á¶»",
		A = "á´¬",
		B = "á´®",
		D = "á´°",
		E = "á´±",
		G = "á´³",
		H = "á´´",
		I = "á´µ",
		J = "á´¶",
		K = "á´·",
		L = "á´¸",
		M = "á´¹",
		N = "á´º",
		O = "á´¼",
		P = "á´¾",
		R = "á´¿",
		T = "áµ€",
		U = "áµ",
		V = "â±½",
		W = "áµ‚",
	}),
	text2("@operator", "superscript", {
		["+"] = "âº",
		["-"] = "â»",
		["<"] = "Ë‚",
		[">"] = "Ëƒ",
		["/"] = "ËŠ",
		["\\."] = "Ë™",
		["="] = "Ë­",
	})
)

return {
	delimiters = delimiters,
	greek = greek,
	operators = operators,
	symbols = symbols,
	typography = typography,
	scripts = scripts,
	subscripts = subscripts,
	supscripts = supscripts,
	misc = misc,
}
